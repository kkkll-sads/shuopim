# 登录重定向功能说明

## ✅ 功能已实现

所有认证页面现在都支持完整的跳转流程！

## 🔄 页面跳转流程

### 1. 登录页面（Login.vue）
**流程：**
```
填写信息 → 点击登录 → 保存 token → 跳转到首页（/home）
```

**功能特点：**
- ✅ 登录表单验证
- ✅ 协议勾选检查
- ✅ 登录中状态显示
- ✅ 保存用户信息到 store
- ✅ 自动跳转到首页

**代码实现：**
```javascript
const handleLogin = async () => {
  // 1. 验证表单
  if (!agreed.value) {
    alert('请先同意服务协议')
    return
  }
  
  // 2. 显示加载状态
  loading.value = true
  
  // 3. 调用登录 API（模拟）
  await new Promise(resolve => setTimeout(resolve, 1000))
  
  // 4. 保存 token 和用户信息
  userStore.setToken(mockToken)
  userStore.setUserInfo(mockUserInfo)
  
  // 5. 跳转到首页
  router.push('/home')
}
```

### 2. 注册页面（Register.vue）
**流程：**
```
填写信息 → 点击注册 → 注册成功 → 跳转到登录页（/login）
```

**功能特点：**
- ✅ 注册表单验证
- ✅ 协议勾选检查
- ✅ 注册中状态显示
- ✅ 成功后提示
- ✅ 自动跳转到登录页

### 3. 找回密码页面（ForgotPassword.vue）
**流程：**
```
填写信息 → 点击修改密码 → 修改成功 → 跳转到登录页（/login）
```

**功能特点：**
- ✅ 密码修改验证
- ✅ 修改中状态显示
- ✅ 成功后提示
- ✅ 自动跳转到登录页

## 🔐 路由守卫

路由守卫自动处理以下场景：

### 场景 1: 未登录访问需要认证的页面
```javascript
// 用户未登录访问 /home
router.beforeEach((to, from, next) => {
  if (to.meta.requiresAuth && !token) {
    next('/login')  // 重定向到登录页
  }
})
```

### 场景 2: 已登录访问登录页
```javascript
// 用户已登录访问 /login
router.beforeEach((to, from, next) => {
  if (to.path === '/login' && token) {
    next('/home')  // 重定向到首页
  }
})
```

### 场景 3: 访问根路径
```javascript
// 访问 /
{
  path: '/',
  redirect: '/login'  // 默认跳转到登录页
}
```

## 📁 涉及的文件

### 修改的文件
1. **src/views/Login.vue**
   - 添加登录逻辑
   - 保存 token 和用户信息
   - 跳转到首页

2. **src/views/Register.vue**
   - 添加注册逻辑
   - 成功后跳转到登录页

3. **src/views/ForgotPassword.vue**
   - 添加修改密码逻辑
   - 成功后跳转到登录页

4. **src/App.vue**
   - 移除重复的跳转逻辑
   - 统一由路由守卫处理

### 使用的现有功能
1. **src/store/user.ts** - 用户状态管理
   - `setToken()` - 保存 token
   - `setUserInfo()` - 保存用户信息
   - `clearAuth()` - 清除认证信息

2. **src/router/index.ts** - 路由配置和守卫
   - 路由守卫自动检查认证状态
   - 自动重定向未登录用户

## 🎯 用户体验优化

### 1. 按钮状态管理
```vue
<button 
  :disabled="loading"
  class="disabled:opacity-50 disabled:cursor-not-allowed"
>
  {{ loading ? '登录中...' : '登录' }}
</button>
```

**效果：**
- 提交中显示"登录中..."
- 按钮变灰且不可点击
- 防止重复提交

### 2. 表单验证
- 检查必填字段
- 检查协议勾选
- 提供友好的错误提示

### 3. 成功反馈
- 注册成功：提示"注册成功！请登录"
- 修改密码：提示"密码修改成功！请登录"
- 登录成功：直接跳转首页

## 🔧 如何测试

### 测试登录流程
1. 访问 http://localhost:3000/login
2. 输入任意手机号和密码
3. 勾选协议
4. 点击"登录"按钮
5. 应该显示"登录中..."
6. 1秒后自动跳转到 http://localhost:3000/home

### 测试注册流程
1. 访问 http://localhost:3000/register
2. 填写注册信息
3. 勾选协议
4. 点击"注册"按钮
5. 应该显示"注册中..."
6. 1秒后提示"注册成功！请登录"
7. 跳转到登录页

### 测试找回密码流程
1. 访问 http://localhost:3000/forgot
2. 填写手机号、验证码、新密码
3. 点击"修改密码"按钮
4. 应该显示"修改中..."
5. 1秒后提示"密码修改成功！请登录"
6. 跳转到登录页

### 测试路由守卫
**测试 1：未登录访问首页**
```
访问 http://localhost:3000/home
→ 自动重定向到 http://localhost:3000/login
```

**测试 2：已登录访问登录页**
```
1. 先登录成功（token 已保存）
2. 访问 http://localhost:3000/login
→ 自动重定向到 http://localhost:3000/home
```

**测试 3：登录后刷新页面**
```
1. 登录成功后在首页
2. 刷新浏览器（F5）
→ 仍然显示首页（token 保存在 localStorage）
```

## 💻 技术实现细节

### Token 管理
```javascript
// 保存 token
localStorage.setItem('token', token)

// 读取 token
const token = localStorage.getItem('token')

// 清除 token
localStorage.removeItem('token')
```

### 路由跳转
```javascript
// 编程式导航
router.push('/home')

// 声明式导航
<button @click="$router.push('/login')">去登录</button>
```

### 状态管理
```javascript
// 使用 Pinia store
const userStore = useUserStore()
userStore.setToken(token)
userStore.setUserInfo(userInfo)
```

## 🚀 后续优化建议

### 1. 连接真实 API
目前使用模拟数据，需要替换为真实 API 调用：

```javascript
// 替换这部分模拟代码
await new Promise(resolve => setTimeout(resolve, 1000))
const mockToken = `mock_token_${Date.now()}`

// 改为真实 API 调用
const response = await axios.post('/api/auth/login', {
  phone: phone.value,
  password: password.value
})
const token = response.data.token
```

### 2. 使用 Toast 提示
替换 `alert()` 为更友好的 Toast 提示：

```javascript
// 使用 Vant 的 Toast
import { showToast } from 'vant'

showToast({
  message: '登录成功',
  type: 'success'
})
```

### 3. 添加错误处理
针对不同错误类型提供具体提示：

```javascript
try {
  await loginAPI()
} catch (error) {
  if (error.code === 'INVALID_PASSWORD') {
    showToast('密码错误')
  } else if (error.code === 'USER_NOT_FOUND') {
    showToast('用户不存在')
  } else {
    showToast('登录失败，请重试')
  }
}
```

### 4. 添加验证码功能
实现真实的短信验证码发送和验证。

### 5. 记住登录状态
添加"记住我"功能，自动填充用户名。

## 📝 注意事项

1. **Token 安全性**
   - Token 存储在 localStorage
   - 实际生产环境建议使用 HttpOnly Cookie
   - 实现 token 刷新机制

2. **表单验证**
   - 目前验证较简单
   - 建议添加手机号格式验证
   - 添加密码强度检查

3. **错误处理**
   - 目前使用 alert 提示
   - 建议使用更友好的 UI 组件

4. **API 集成**
   - 需要替换模拟 API
   - 添加请求拦截器
   - 统一错误处理

## ✅ 完成状态

- ✅ 登录后跳转到首页
- ✅ 注册后跳转到登录页
- ✅ 修改密码后跳转到登录页
- ✅ 路由守卫自动重定向
- ✅ 按钮加载状态
- ✅ 表单验证
- ✅ Token 保存和读取

**所有基础功能已完成，可以继续开发其他功能！** 🎉

